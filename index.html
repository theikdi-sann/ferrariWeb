<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferrari Official | Sports Cars, Racing, & News</title>
    <meta name="description" content="Experience the world of Ferrari. Discover the Scuderia Ferrari, the line of sports cars, and the exclusive collections.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;800&family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom Configuration for Tailwind -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'ferrari-red': '#D40000',
                        'ferrari-yellow': '#FFF200',
                        'ferrari-black': '#111111',
                        'ferrari-dark': '#0a0a0a',
                        'ferrari-gray': '#333333',
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        display: ['Oswald', 'sans-serif'],
                    },
                    spacing: {
                        '128': '32rem',
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 1s ease-out forwards',
                        'slide-in': 'slideIn 1.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111;
        }
        ::-webkit-scrollbar-thumb {
            background: #D40000;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #b30000;
        }

        /* Utility Classes */
        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        /* Navigation Hover Effect */
        .nav-link {
            position: relative;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 0;
            background-color: #D40000;
            transition: width 0.3s ease;
        }
        .nav-link:hover::after {
            width: 100%;
        }

        /* Parallax & Hero */
        .hero-bg {
            background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.6)), url('./hero.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        /* Card Hover Zoom */
        .card-zoom {
            overflow: hidden;
        }
        .card-zoom img {
            transition: transform 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .card-zoom:hover img {
            transform: scale(1.05);
        }

        /* Loading Screen */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease-out;
        }
        
        .prancing-horse-loader {
            font-size: 80px;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; transform: scale(0.95); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.5; transform: scale(0.95); }
        }

        /* CONFIGURATOR STYLES */
        .config-overlay {
            mix-blend-mode: overlay;
            transition: background-color 0.5s ease;
        }
        
        .option-btn.active {
            border-color: #D40000;
            color: white;
        }
        
        .color-swatch {
            transition: transform 0.2s;
        }
        .color-swatch:hover {
            transform: scale(1.1);
        }
        .color-swatch.active {
            transform: scale(1.2);
            box-shadow: 0 0 0 2px white, 0 0 0 4px #D40000;
        }

        /* IMAGE MANIPULATION CLASSES */
        #car-preview-container {
            transition: transform 1.2s cubic-bezier(0.22, 1, 0.36, 1);
            transform-origin: center center;
            position: relative;
        }

        #car-canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* Zoom States */
        .zoom-wheel {
            transform: scale(2.8) translate(-10%, -15%); /* Zoom to rear wheel area of the specific image */
        }

        /* Fallback Filters (Only used if Canvas fails) */
        .filter-fallback-red { filter: sepia(0) hue-rotate(0deg) saturate(1) brightness(1); }
        .filter-fallback-yellow { filter: sepia(0) hue-rotate(45deg) saturate(2.5) brightness(1.5); }
        .filter-fallback-black { filter: grayscale(100%) brightness(0.6) contrast(1.2); }
        .filter-fallback-silver { filter: grayscale(100%) brightness(1.1) contrast(1.1); }
        .filter-fallback-blue { filter: hue-rotate(220deg) saturate(1.5) brightness(0.8); }
        .filter-fallback-green { filter: hue-rotate(90deg) saturate(0.8) brightness(0.8); }

        /* Rim/Caliper Overlays */
        .wheel-overlay {
            position: absolute;
            transition: all 0.5s ease;
            pointer-events: none;
            border-radius: 50%;
        }
        
        /* Helper to hide raw image used for canvas source */
        #source-image {
            display: none;
        }
        
        /* Modal Transitions */
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms, transform 300ms;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 300ms, transform 300ms;
        }

    </style>
</head>
<body class="bg-ferrari-black text-white font-sans antialiased overflow-x-hidden selection:bg-ferrari-red selection:text-white">

    <!-- Loading Screen -->
    <div id="loader">
        <i class="fa-solid fa-horse text-ferrari-red prancing-horse-loader"></i>
    </div>

    <!-- Navigation -->
    <nav id="navbar" class="fixed w-full z-50 transition-all duration-500 bg-transparent py-4 border-b border-transparent hover:bg-black/90">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <button class="lg:hidden text-white focus:outline-none">
                <i class="fas fa-bars text-2xl"></i>
            </button>
            <div class="hidden lg:flex space-x-8 text-xs font-bold tracking-widest uppercase">
                <a href="#" class="nav-link hover:text-gray-300 transition">Racing</a>
                <a href="#" class="nav-link hover:text-gray-300 transition">Sports Cars</a>
                <a href="#" class="nav-link hover:text-gray-300 transition">Collections</a>
            </div>
            <div class="flex-shrink-0 mx-auto lg:mx-0">
                <a href="#" class="flex flex-col items-center group">
                    <div class="w-8 h-10 bg-ferrari-yellow rounded-t-sm flex items-center justify-center relative shadow-lg group-hover:scale-110 transition duration-300">
                         <i class="fa-solid fa-horse text-black text-xl mb-1"></i>
                         <div class="absolute top-0 w-full h-[2px] bg-green-600"></div>
                         <div class="absolute top-[2px] w-full h-[2px] bg-white"></div>
                         <div class="absolute top-[4px] w-full h-[2px] bg-red-600"></div>
                    </div>
                    <span class="mt-1 font-display font-bold tracking-widest text-lg">FERRARI</span>
                </a>
            </div>
            <div class="hidden lg:flex space-x-8 text-xs font-bold tracking-widest uppercase">
                <a href="#" class="nav-link hover:text-gray-300 transition">Experiences</a>
                <a href="#" class="nav-link hover:text-gray-300 transition">Universe</a>
                <a href="#" class="nav-link hover:text-gray-300 transition">Store</a>
            </div>
            <div class="flex space-x-4 lg:hidden">
                <i class="fas fa-search"></i>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header class="relative h-screen w-full overflow-hidden hero-bg flex items-end justify-start pb-24">
        <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-90"></div>
        <div class="absolute inset-0 bg-gradient-to-r from-black/50 via-transparent to-transparent"></div>
        <div class="relative z-10 container mx-auto px-6">
            <h2 class="text-ferrari-red font-bold tracking-[0.3em] uppercase text-sm mb-4 animate-fade-in-up" style="animation-delay: 0.2s;">New Release</h2>
            <h1 class="font-display font-medium text-6xl md:text-8xl lg:text-9xl uppercase leading-none mb-6 animate-fade-in-up" style="animation-delay: 0.4s;">
                SF90 XX <br> <span class="text-stroke text-transparent bg-clip-text bg-white">Stradale</span>
            </h1>
            <p class="text-gray-300 max-w-lg text-lg mb-8 font-light animate-fade-in-up" style="animation-delay: 0.6s;">
                The first road-legal XX. A milestone in Ferrari history, delivering extreme performance for the road.
            </p>
            <div class="flex space-x-4 animate-fade-in-up" style="animation-delay: 0.8s;">
                <button class="bg-ferrari-red text-white px-8 py-3 text-sm font-bold uppercase tracking-widest hover:bg-white hover:text-ferrari-red transition duration-300 clip-path-slant">
                    Discover More
                </button>
                <button id="hero-configure-btn" onclick="openConfigurator('SF90 XX Stradale', 850000, 'https://images.unsplash.com/photo-1592198084033-aade902d1aae?q=80&w=2940&auto=format&fit=crop')" class="border border-white text-white px-8 py-3 text-sm font-bold uppercase tracking-widest hover:bg-white hover:text-black transition duration-300">
                    Configure
                </button>
            </div>
        </div>
        <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
            <i class="fas fa-chevron-down text-white text-xl opacity-50"></i>
        </div>
    </header>

    <!-- Latest Models Section -->
    <section class="py-20 bg-ferrari-black">
        <div class="container mx-auto px-6 mb-12 flex justify-between items-end">
            <div>
                <h3 class="text-ferrari-red font-bold tracking-widest uppercase text-sm mb-2">The Range</h3>
                <h2 class="font-display text-4xl md:text-5xl font-medium uppercase text-white">Latest Masterpieces</h2>
            </div>
            <a href="#" class="hidden md:inline-block text-xs font-bold uppercase tracking-widest border-b border-gray-600 pb-1 hover:text-ferrari-red hover:border-ferrari-red transition">View All Models</a>
        </div>
        <div class="overflow-x-auto pb-8 hide-scrollbar">
            <div class="flex space-x-6 px-6" style="width: max-content;">
                
                <!-- Model 1 (Updated to Enzo Ferrari) -->
                <div class="group relative w-[85vw] md:w-[600px] h-[400px] bg-ferrari-dark cursor-pointer overflow-hidden" 
     onclick="openConfigurator('Enzo Ferrari', 3500000, 'https://images.unsplash.com/photo-1592198084033-aade902d1aae?q=80&w=2940&auto=format&fit=crop')">
    <div class="absolute inset-0 card-zoom">
        <img src="https://images.unsplash.com/photo-1592198084033-aade902d1aae?q=80&w=2940&auto=format&fit=crop" alt="Enzo Ferrari" class="w-full h-full object-cover opacity-80 group-hover:opacity-100">
    </div>
    <div class="absolute bottom-0 left-0 w-full p-8 bg-gradient-to-t from-black to-transparent">
        <h3 class="font-display text-3xl uppercase mb-2 transform translate-y-4 group-hover:translate-y-0 transition duration-500">Enzo Ferrari</h3>
        <p class="text-xs text-gray-400 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition duration-500 delay-100">The Legend Lives On</p>
    </div>
</div>

                <!-- Model 2 (296 GTB - The Tuned Demo) -->
                <div class="group relative w-[85vw] md:w-[600px] h-[400px] bg-ferrari-dark cursor-pointer overflow-hidden" 
                     onclick="openConfigurator('296 GTB', 320000, 'https://images.unsplash.com/photo-1583121274602-3e2820c69888?q=80&w=2940&auto=format&fit=crop')">
                    <div class="absolute inset-0 card-zoom">
                        <img src="https://images.unsplash.com/photo-1583121274602-3e2820c69888?q=80&w=2940&auto=format&fit=crop" alt="Ferrari 296 GTB" class="w-full h-full object-cover opacity-80 group-hover:opacity-100">
                    </div>
                    <div class="absolute bottom-0 left-0 w-full p-8 bg-gradient-to-t from-black to-transparent">
                        <h3 class="font-display text-3xl uppercase mb-2 transform translate-y-4 group-hover:translate-y-0 transition duration-500">296 GTB</h3>
                        <p class="text-xs text-gray-400 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition duration-500 delay-100">Defining Fun to Drive</p>
                    </div>
                </div>

                <!-- Model 3 (Updated to LaFerrari) -->
                <div class="group relative w-[85vw] md:w-[600px] h-[400px] bg-ferrari-dark cursor-pointer overflow-hidden" 
     onclick="openConfigurator('LaFerrari', 4000000, 'https://images.unsplash.com/photo-1614162692292-7ac56d7f7f1e?q=80&w=2940&auto=format&fit=crop')">
    <div class="absolute inset-0 card-zoom">
        <img src="https://images.unsplash.com/photo-1614162692292-7ac56d7f7f1e?q=80&w=2940&auto=format&fit=crop" alt="LaFerrari" class="w-full h-full object-cover opacity-80 group-hover:opacity-100">
    </div>
    <div class="absolute bottom-0 left-0 w-full p-8 bg-gradient-to-t from-black to-transparent">
        <h3 class="font-display text-3xl uppercase mb-2 transform translate-y-4 group-hover:translate-y-0 transition duration-500">LaFerrari</h3>
        <p class="text-xs text-gray-400 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition duration-500 delay-100">The Definitive Hypercar</p>
    </div>

            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-ferrari-dark text-white border-t border-gray-900">
        <div class="container mx-auto px-6 py-16">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <div class="flex flex-col items-start">
                    <div class="flex items-center mb-6">
                        <i class="fa-solid fa-horse text-3xl mr-2 text-white"></i>
                        <span class="font-display font-bold text-2xl tracking-widest">FERRARI</span>
                    </div>
                    <p class="text-gray-500 text-sm mb-6">
                        Automobili Ferrari S.p.A. <br>
                        Via Abetone Inferiore n. 4, <br>
                        I-41053 Maranello (MO)
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="w-10 h-10 rounded-full border border-gray-700 flex items-center justify-center hover:bg-white hover:text-black transition"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full border border-gray-700 flex items-center justify-center hover:bg-white hover:text-black transition"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full border border-gray-700 flex items-center justify-center hover:bg-white hover:text-black transition"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full border border-gray-700 flex items-center justify-center hover:bg-white hover:text-black transition"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div>
                    <h4 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6">Racing</h4>
                    <ul class="space-y-3 text-sm font-medium">
                        <li><a href="#" class="hover:text-ferrari-red transition">Scuderia Ferrari</a></li>
                        <li><a href="#" class="hover:text-ferrari-red transition">Charles Leclerc</a></li>
                        <li><a href="#" class="hover:text-ferrari-red transition">Carlos Sainz</a></li>
                        <li><a href="#" class="hover:text-ferrari-red transition">Hypercar</a></li>
                        <li><a href="#" class="hover:text-ferrari-red transition">Esports</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6">Sports Cars</h4>
                    <ul class="space-y-3 text-sm font-medium">
                        <li><a href="#" class="hover:text-ferrari-red transition">Range</a></li>
                        <li><a href="#" class="hover:text-ferrari-red transition">Configurator</a></li>
                        <li><a href="#" class="hover:text-ferrari-red transition">Pre-Owned</a></li>
                        <li><a href="#" class="hover:text-ferrari-red transition">MyFerrari</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-xs font-bold uppercase tracking-widest text-gray-400 mb-6">Newsletter</h4>
                    <p class="text-gray-500 text-sm mb-4">Subscribe to receive the latest news from the world of Ferrari.</p>
                    <form class="flex flex-col space-y-3">
                        <input type="email" placeholder="Email Address" class="bg-gray-900 border border-gray-800 text-white px-4 py-3 focus:outline-none focus:border-ferrari-red text-sm">
                        <button class="bg-ferrari-red text-white py-3 text-sm font-bold uppercase tracking-widest hover:bg-white hover:text-black transition">Subscribe</button>
                    </form>
                </div>
            </div>
            <div class="border-t border-gray-900 mt-16 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-600">
                <div class="mb-4 md:mb-0">
                    &copy; 2024 Ferrari S.p.A. All rights reserved.
                </div>
                <div class="flex space-x-6">
                    <a href="#" class="hover:text-white transition">Legal</a>
                    <a href="#" class="hover:text-white transition">Privacy Policy</a>
                    <a href="#" class="hover:text-white transition">Cookie Policy</a>
                    <a href="#" class="hover:text-white transition">Accessibility</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- CONFIGURATOR MODAL -->
    <div id="configurator-modal" class="fixed inset-0 z-[100] bg-black transform translate-y-full transition-transform duration-700 ease-in-out flex flex-col md:flex-row">
        
        <!-- Close Button -->
        <button onclick="closeConfigurator()" class="absolute top-6 right-6 z-50 text-white hover:text-ferrari-red transition text-2xl">
            <i class="fas fa-times"></i>
        </button>

        <!-- Left: Car Preview -->
        <div class="w-full md:w-2/3 h-1/2 md:h-full relative bg-gray-900 flex items-center justify-center overflow-hidden">
            <div class="relative w-full max-w-4xl px-4 h-full flex items-center justify-center">
                <!-- Header in Preview -->
                <div class="absolute top-0 left-0 p-8 w-full z-20 pointer-events-none">
                    <h3 class="text-ferrari-red font-bold tracking-widest uppercase text-sm mb-1">Configurator</h3>
                    <h2 id="configurator-title" class="font-display text-4xl uppercase text-white">296 GTB</h2>
                </div>

                <!-- Zoom Container - ASPECT RATIO FIX: Use aspect-[3/2] to match source image (2940x1960) -->
                <div id="car-preview-container" class="relative w-full aspect-[3/2] transition-all duration-1000 ease-in-out">
                    
                    <!-- Canvas for pixel manipulation (Replaces standard IMG) -->
                    <canvas id="car-canvas" class="absolute inset-0 z-10"></canvas>
                    
                    <!-- Source Image (Hidden, used for loading data) -->
                    <img id="source-image" crossorigin="anonymous" src="https://images.unsplash.com/photo-1583121274602-3e2820c69888?q=80&w=2940&auto=format&fit=crop" alt="Ferrari Source">

                    <!-- Rim Darkening Overlays -->
                    <!-- Rear -->
                    <div id="rim-overlay-rear" class="wheel-overlay bg-black mix-blend-multiply opacity-0 z-20" 
                         style="top: 52%; left: 70%; width: 14%; height: 25%;"></div>
                    <!-- Front -->
                    <div id="rim-overlay-front" class="wheel-overlay bg-black mix-blend-multiply opacity-0 z-20" 
                         style="top: 52%; left: 23%; width: 13.5%; height: 25%;"></div>
                         
                    <!-- Caliper Color Overlays (Changed mix-blend-mode to normal for visibility) -->
                    <!-- Rear -->
                    <div id="caliper-overlay-rear" class="wheel-overlay bg-yellow-400 opacity-0 z-20" 
                         style="top: 57%; left: 74%; width: 5%; height: 9%;"></div>
                    <!-- Front -->
                    <div id="caliper-overlay-front" class="wheel-overlay bg-yellow-400 opacity-0 z-20" 
                         style="top: 57%; left: 32%; width: 5%; height: 9%;"></div>

                </div>
                
                <!-- Disclaimer -->
                <p class="absolute bottom-4 left-0 w-full text-center text-xs text-gray-600 uppercase tracking-widest">Visualisation purposes only</p>
            </div>
        </div>

        <!-- Right: Controls -->
        <div class="w-full md:w-1/3 h-1/2 md:h-full bg-ferrari-dark border-l border-gray-800 flex flex-col">
            <div class="flex-1 overflow-y-auto p-8 custom-scrollbar">
                
                <!-- Section: Paint -->
                <div class="mb-10">
                    <h4 class="font-display text-lg uppercase mb-4 flex justify-between items-center cursor-pointer" onclick="resetZoom()">
                        Exterior 
                        <span class="text-ferrari-red text-xs font-bold tracking-widest">Standard</span>
                    </h4>
                    <div class="flex flex-wrap gap-4">
                        <button onclick="changeColor('red')" class="w-10 h-10 rounded-full bg-red-600 color-swatch active" title="Rosso Corsa"></button>
                        <button onclick="changeColor('yellow')" class="w-10 h-10 rounded-full bg-yellow-400 color-swatch" title="Giallo Modena"></button>
                        <button onclick="changeColor('black')" class="w-10 h-10 rounded-full bg-black border border-gray-700 color-swatch" title="Nero"></button>
                        <button onclick="changeColor('silver')" class="w-10 h-10 rounded-full bg-gray-300 color-swatch" title="Argento Nurburgring"></button>
                        <button onclick="changeColor('blue')" class="w-10 h-10 rounded-full bg-blue-800 color-swatch" title="Blu Tour de France"></button>
                        <button onclick="changeColor('green')" class="w-10 h-10 rounded-full bg-green-900 color-swatch" title="Verde British"></button>
                    </div>
                </div>

                <!-- Section: Wheels -->
                <div class="mb-10">
                    <h4 class="font-display text-lg uppercase mb-4">Rims</h4>
                    <div class="space-y-3">
                        <button onclick="selectOption(this, 'rims', 0, 'standard')" class="option-btn active w-full text-left p-4 border border-gray-800 hover:border-gray-500 bg-gray-900/50 transition flex justify-between group">
                            <span class="text-sm font-bold uppercase tracking-wider text-gray-300 group-hover:text-white">20" Standard Forged</span>
                            <span class="text-xs text-gray-500">Included</span>
                        </button>
                        <button onclick="selectOption(this, 'rims', 15000, 'carbon')" class="option-btn w-full text-left p-4 border border-gray-800 hover:border-gray-500 bg-gray-900/50 transition flex justify-between group">
                            <span class="text-sm font-bold uppercase tracking-wider text-gray-300 group-hover:text-white">20" Dark Finish</span>
                            <span class="text-xs text-gray-500">$15,000</span>
                        </button>
                    </div>
                </div>

                <!-- Section: Calipers -->
                <div class="mb-10">
                    <h4 class="font-display text-lg uppercase mb-4">Brake Calipers</h4>
                    <div class="space-y-3">
                        <button onclick="selectOption(this, 'calipers', 0, 'silver')" class="option-btn active w-full text-left p-4 border border-gray-800 hover:border-gray-500 bg-gray-900/50 transition flex justify-between group">
                            <span class="text-sm font-bold uppercase tracking-wider text-gray-300 group-hover:text-white">Aluminum (Standard)</span>
                            <span class="text-xs text-gray-500">Included</span>
                        </button>
                        <button onclick="selectOption(this, 'calipers', 4000, 'yellow')" class="option-btn w-full text-left p-4 border border-gray-800 hover:border-gray-500 bg-gray-900/50 transition flex justify-between group">
                            <span class="text-sm font-bold uppercase tracking-wider text-gray-300 group-hover:text-white">Giallo Modena</span>
                            <span class="text-xs text-gray-500">$4,000</span>
                        </button>
                        <button onclick="selectOption(this, 'calipers', 4000, 'red')" class="option-btn w-full text-left p-4 border border-gray-800 hover:border-gray-500 bg-gray-900/50 transition flex justify-between group">
                            <span class="text-sm font-bold uppercase tracking-wider text-gray-300 group-hover:text-white">Rosso Corsa</span>
                            <span class="text-xs text-gray-500">$4,000</span>
                        </button>
                    </div>
                </div>

            </div>

            <!-- Footer: Price & Action -->
            <div class="p-8 border-t border-gray-800 bg-black">
                <div class="flex justify-between items-end mb-4">
                    <span class="text-xs font-bold uppercase tracking-widest text-gray-500">Total Price</span>
                    <span id="total-price" class="font-display text-2xl text-white">$550,000</span>
                </div>
                <button onclick="openUserInfo()" class="w-full bg-ferrari-red text-white py-4 text-sm font-bold uppercase tracking-widest hover:bg-white hover:text-black transition duration-300">
                    Request Quote
                </button>
            </div>
        </div>
    </div>

    <!-- USER INFO MODAL -->
    <div id="user-info-modal" class="fixed inset-0 z-[110] bg-black/95 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-ferrari-dark border border-gray-800 w-full max-w-lg p-8 relative shadow-2xl transform transition-all">
            <button onclick="closeModal('user-info-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-ferrari-red transition">
                <i class="fas fa-times text-xl"></i>
            </button>
            
            <div class="text-center mb-8">
                <h3 class="text-ferrari-red font-bold tracking-widest uppercase text-xs mb-2">Step 1 of 2</h3>
                <h2 class="font-display text-3xl uppercase text-white">Your Details</h2>
                <div class="w-12 h-1 bg-ferrari-red mx-auto mt-4"></div>
            </div>

            <form id="user-form" onsubmit="openPayment(event)" class="space-y-6">
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-gray-400">First Name</label>
                        <input type="text" required class="w-full bg-black border border-gray-800 text-white px-4 py-3 text-sm focus:outline-none focus:border-ferrari-red transition">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-gray-400">Last Name</label>
                        <input type="text" required class="w-full bg-black border border-gray-800 text-white px-4 py-3 text-sm focus:outline-none focus:border-ferrari-red transition">
                    </div>
                </div>
                <div class="space-y-2">
                    <label class="text-xs font-bold uppercase tracking-widest text-gray-400">Email Address</label>
                    <input type="email" required class="w-full bg-black border border-gray-800 text-white px-4 py-3 text-sm focus:outline-none focus:border-ferrari-red transition">
                </div>
                <div class="space-y-2">
                    <label class="text-xs font-bold uppercase tracking-widest text-gray-400">Phone Number</label>
                    <input type="tel" required class="w-full bg-black border border-gray-800 text-white px-4 py-3 text-sm focus:outline-none focus:border-ferrari-red transition">
                </div>
                
                <button type="submit" class="w-full bg-ferrari-red text-white py-4 text-sm font-bold uppercase tracking-widest hover:bg-white hover:text-black transition duration-300 mt-4">
                    Proceed to Payment
                </button>
            </form>
        </div>
    </div>

    <!-- PAYMENT MODAL -->
    <div id="payment-modal" class="fixed inset-0 z-[120] bg-black/95 backdrop-blur-sm hidden flex items-center justify-center p-4">
        <div class="bg-ferrari-dark border border-gray-800 w-full max-w-2xl p-8 relative shadow-2xl flex flex-col md:flex-row gap-8">
            <button onclick="closeModal('payment-modal')" class="absolute top-4 right-4 text-gray-400 hover:text-ferrari-red transition z-10">
                <i class="fas fa-times text-xl"></i>
            </button>

            <!-- Order Summary -->
            <div class="w-full md:w-1/2 border-b md:border-b-0 md:border-r border-gray-800 pb-8 md:pb-0 md:pr-8">
                <h3 class="text-ferrari-red font-bold tracking-widest uppercase text-xs mb-6">Order Summary</h3>
                <h2 id="summary-model" class="font-display text-2xl uppercase text-white mb-1">296 GTB</h2>
                <p id="summary-color" class="text-gray-400 text-sm mb-6">Rosso Corsa</p>
                
                <div class="space-y-4 text-sm">
                    <div class="flex justify-between text-gray-400">
                        <span>Base Price</span>
                        <span id="summary-base-price" class="text-white">$550,000</span>
                    </div>
                    <div class="flex justify-between text-gray-400">
                        <span>Rims</span>
                        <span id="summary-rims" class="text-white">Standard</span>
                    </div>
                    <div class="flex justify-between text-gray-400">
                        <span>Calipers</span>
                        <span id="summary-calipers" class="text-white">Standard</span>
                    </div>
                    <div class="h-px bg-gray-800 my-4"></div>
                    <div class="flex justify-between font-bold text-lg">
                        <span class="text-ferrari-red uppercase tracking-widest">Total</span>
                        <span id="summary-total" class="text-white">$550,000</span>
                    </div>
                </div>
            </div>

            <!-- Payment Form -->
            <div class="w-full md:w-1/2">
                <div class="text-left mb-6">
                    <h3 class="text-ferrari-red font-bold tracking-widest uppercase text-xs mb-2">Step 2 of 2</h3>
                    <h2 class="font-display text-2xl uppercase text-white">Payment</h2>
                </div>

                <form id="payment-form" onsubmit="submitPayment(event)" class="space-y-4">
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-gray-400">Cardholder Name</label>
                        <input type="text" placeholder="AS ON CARD" required class="w-full bg-black border border-gray-800 text-white px-4 py-3 text-sm focus:outline-none focus:border-ferrari-red transition">
                    </div>
                    <div class="space-y-2">
                        <label class="text-xs font-bold uppercase tracking-widest text-gray-400">Card Number</label>
                        <div class="relative">
                            <input type="text" placeholder="0000 0000 0000 0000" maxlength="19" required class="w-full bg-black border border-gray-800 text-white px-4 py-3 text-sm focus:outline-none focus:border-ferrari-red transition">
                            <i class="fab fa-cc-visa absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500 text-xl"></i>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-widest text-gray-400">Expiry</label>
                            <input type="text" placeholder="MM/YY" maxlength="5" required class="w-full bg-black border border-gray-800 text-white px-4 py-3 text-sm focus:outline-none focus:border-ferrari-red transition">
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold uppercase tracking-widest text-gray-400">CVV</label>
                            <input type="text" placeholder="123" maxlength="3" required class="w-full bg-black border border-gray-800 text-white px-4 py-3 text-sm focus:outline-none focus:border-ferrari-red transition">
                        </div>
                    </div>

                    <button id="pay-btn" type="submit" class="w-full bg-white text-black py-4 text-sm font-bold uppercase tracking-widest hover:bg-ferrari-red hover:text-white transition duration-300 mt-4 flex justify-center items-center">
                        <span>Confirm Order</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- SUCCESS MODAL -->
    <div id="success-modal" class="fixed inset-0 z-[130] bg-black flex flex-col items-center justify-center p-4 hidden">
        <div class="text-center animate-fade-in-up">
            <div class="w-24 h-24 rounded-full border-2 border-ferrari-red flex items-center justify-center mx-auto mb-8 text-ferrari-red">
                <i class="fas fa-check text-4xl"></i>
            </div>
            <h2 class="font-display text-4xl md:text-5xl uppercase text-white mb-4">Request Received</h2>
            <p class="text-gray-400 max-w-md mx-auto mb-10 text-lg font-light">
                Your configuration has been sent to your nearest Ferrari dealer. A representative will contact you shortly to finalize your order.
            </p>
            <button onclick="resetAll()" class="bg-ferrari-red text-white px-10 py-4 text-sm font-bold uppercase tracking-widest hover:bg-white hover:text-black transition duration-300">
                Return to Home
            </button>
        </div>
    </div>

    <script>
        // Navbar scroll effect
        window.addEventListener('scroll', function() {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('bg-black', 'shadow-lg', 'py-2');
                navbar.classList.remove('bg-transparent', 'py-4');
            } else {
                navbar.classList.remove('bg-black', 'shadow-lg', 'py-2');
                navbar.classList.add('bg-transparent', 'py-4');
            }
        });

        // Loader removal
        window.addEventListener('load', function() {
            const loader = document.getElementById('loader');
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => {
                    loader.style.display = 'none';
                }, 500);
            }, 1000);
        });

        // Intersection Observer for fade-in elements
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fade-in-up');
                    entry.target.style.opacity = '1';
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // --- CONFIGURATOR LOGIC ---
        
        let basePrice = 550000;
        let currentModelName = '296 GTB';
        let currentOptions = {
            rims: 0,
            calipers: 0,
            color: 'Red' // Default color name
        };
        let areOverlaysSupported = true;

        // Canvas Variables
        const canvas = document.getElementById('car-canvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const sourceImg = document.getElementById('source-image');
        let originalImageData = null;
        let fallbackMode = false;

        // Initialize Canvas when Source Image Loads
        sourceImg.onload = function() {
            initCanvas();
        };

        if (sourceImg.complete) {
            initCanvas();
        }

        function initCanvas() {
            try {
                // Set canvas size to match the high-res source image
                canvas.width = sourceImg.naturalWidth;
                canvas.height = sourceImg.naturalHeight;
                
                // Draw image
                ctx.drawImage(sourceImg, 0, 0);
                
                // Store original pixels for manipulation
                // NOTE: This will fail if CORS prevents access (locally without server)
                originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                fallbackMode = false;
            } catch (e) {
                console.warn("Canvas Tainted/CORS error. Switching to CSS fallback mode.", e);
                fallbackMode = true;
            }
        }

        function openConfigurator(modelName, price, imageUrl) {
            // Default check (if called without args, though triggers usually have them)
            if (!modelName) {
                // Fallback or use existing/default
                if(!currentModelName) currentModelName = '296 GTB';
            } else {
                currentModelName = modelName;
                basePrice = price;
            }

            // Update Text
            document.getElementById('configurator-title').innerText = currentModelName;

            // Reset Options
            currentOptions.rims = 0;
            currentOptions.calipers = 0;
            currentOptions.color = 'Red';
            
            // Reset Active Swatches
            document.querySelectorAll('.color-swatch').forEach(s => s.classList.remove('active'));
            document.querySelector('.color-swatch[title="Rosso Corsa"]')?.classList.add('active'); // Default Red

            // Reset Option Buttons to default
            document.querySelectorAll('.option-btn').forEach(btn => {
                // Simplified reset logic: remove active from price>0, add active to price=0
                const isDefault = btn.querySelector('.text-gray-500').innerText === 'Included';
                if(isDefault) {
                     btn.classList.add('active');
                     btn.classList.remove('border-gray-800', 'text-gray-300');
                } else {
                     btn.classList.remove('active', 'border-ferrari-red', 'text-white');
                     btn.classList.add('border-gray-800', 'text-gray-300');
                }
            });

            // Update Price Display
            updatePrice();

            // Update Image
            if (imageUrl) {
                const img = document.getElementById('source-image');
                if (img.src !== imageUrl) {
                    img.src = imageUrl;
                    // initCanvas will trigger on load
                }
            }

            // Handle Overlays (Only supported on the specific 296 GTB image we tuned)
            areOverlaysSupported = (currentModelName === '296 GTB');
            toggleOverlays(areOverlaysSupported);

            document.getElementById('configurator-modal').classList.remove('translate-y-full');
            document.body.style.overflow = 'hidden'; // Prevent scrolling bg
        }
        
        function toggleOverlays(show) {
            const display = show ? 'block' : 'none';
            document.getElementById('rim-overlay-rear').style.display = display;
            document.getElementById('rim-overlay-front').style.display = display;
            document.getElementById('caliper-overlay-rear').style.display = display;
            document.getElementById('caliper-overlay-front').style.display = display;
        }

        function closeConfigurator() {
            document.getElementById('configurator-modal').classList.add('translate-y-full');
            document.body.style.overflow = 'auto';
        }

        function updatePrice() {
            const total = basePrice + currentOptions.rims + currentOptions.calipers;
            document.getElementById('total-price').innerText = '$' + total.toLocaleString();
        }

        function resetZoom() {
            const container = document.getElementById('car-preview-container');
            container.classList.remove('zoom-wheel');
        }

        function selectOption(btn, category, price, variant) {
            // Remove active class from siblings
            const parent = btn.parentNode;
            const siblings = parent.querySelectorAll('.option-btn');
            siblings.forEach(el => el.classList.remove('active', 'border-ferrari-red', 'text-white'));
            siblings.forEach(el => el.classList.add('border-gray-800', 'text-gray-300'));

            // Add active class to clicked
            btn.classList.add('active');
            
            // Update state
            currentOptions[category] = price;
            updatePrice();

            // Zoom Effect
            const container = document.getElementById('car-preview-container');
            if ((category === 'rims' || category === 'calipers') && areOverlaysSupported) {
                container.classList.add('zoom-wheel');
            }

            // Apply Visual Changes for Rims/Calipers (Only if supported)
            if (!areOverlaysSupported) return;

            if (category === 'rims') {
                const overlayRear = document.getElementById('rim-overlay-rear');
                const overlayFront = document.getElementById('rim-overlay-front');
                if (variant === 'carbon') {
                    overlayRear.style.opacity = '0.6';
                    overlayFront.style.opacity = '0.6';
                } else {
                    overlayRear.style.opacity = '0';
                    overlayFront.style.opacity = '0';
                }
            }

            if (category === 'calipers') {
                const overlayRear = document.getElementById('caliper-overlay-rear');
                const overlayFront = document.getElementById('caliper-overlay-front');
                
                let color = '';
                let opacity = '0.9';

                if (variant === 'yellow') {
                    color = '#facc15'; // Yellow
                } else if (variant === 'red') {
                    color = '#dc2626'; // Red
                } else {
                    opacity = '0';
                }

                overlayRear.style.backgroundColor = color;
                overlayRear.style.opacity = opacity;
                overlayFront.style.backgroundColor = color;
                overlayFront.style.opacity = opacity;
            }
        }

        // --- CORE COLOR LOGIC ---

        function changeColor(color) {
            const swatches = document.querySelectorAll('.color-swatch');
            
            // Update state for summary
            const colorMap = {
                'red': 'Rosso Corsa',
                'yellow': 'Giallo Modena',
                'black': 'Nero',
                'silver': 'Argento Nurburgring',
                'blue': 'Blu Tour de France',
                'green': 'Verde British'
            };
            currentOptions.color = colorMap[color] || 'Custom';

            // Update Swatch UI
            swatches.forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            
            resetZoom();

            if (fallbackMode) {
                // Fallback: Apply CSS filter to the canvas element itself if Canvas access failed
                // Remove existing filter classes
                canvas.className = canvas.className.replace(/filter-fallback-\w+/g, '');
                // Add new filter class
                if (color !== 'red') {
                   canvas.classList.add('filter-fallback-' + color);
                }
                return;
            }

            if (!originalImageData) return;

            // Restore original pixels first
            ctx.putImageData(originalImageData, 0, 0);
            
            if (color === 'red') return; // Default is red, so we are done

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];

                // --- ISOLATION ALGORITHM ---
                // Detect "Ferrari Red" pixels:
                // 1. Red is significantly dominant (r > g and r > b)
                // 2. High enough saturation (diff between max and min channel)
                // 3. Not too dark (avoid deep shadows)
                
                const isRed = (r > g + 40) && (r > b + 40) && (r > 60);

                if (isRed) {
                    const [h, s, l] = rgbToHsl(r, g, b);
                    let newR, newG, newB;

                    if (color === 'yellow') {
                        // Shift Hue to Yellow (~55), Boost Lightness
                        const newH = 55 / 360; 
                        const newL = Math.min(l * 1.5, 0.9); 
                        [newR, newG, newB] = hslToRgb(newH, s, newL);
                    } 
                    else if (color === 'black') {
                        // Desaturate completely, Darken significantly
                        const newL = l * 0.2; 
                        [newR, newG, newB] = hslToRgb(h, 0, newL);
                    }
                    else if (color === 'silver') {
                        // Desaturate completely, Brighten significantly (but maintain metallic contrast)
                        const newL = Math.min(l * 2.5, 0.9);
                        [newR, newG, newB] = hslToRgb(h, 0, newL);
                    }
                    else if (color === 'blue') {
                         // Shift Hue to Blue (~220)
                         const newH = 220 / 360;
                         [newR, newG, newB] = hslToRgb(newH, s, l * 0.8);
                    }
                    else if (color === 'green') {
                        // Shift Hue to Green (~120)
                        const newH = 100 / 360;
                        [newR, newG, newB] = hslToRgb(newH, s * 0.8, l * 0.6);
                    }

                    data[i] = newR;
                    data[i + 1] = newG;
                    data[i + 2] = newB;
                }
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // --- CHECKOUT & MODAL LOGIC ---

        function openUserInfo() {
            // Close configurator view mostly visually but keep it in background
            // We'll overlay the User Info modal
            document.getElementById('user-info-modal').classList.remove('hidden');
            // Animate entry
            document.getElementById('user-info-modal').classList.add('modal-enter-active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function openPayment(e) {
            e.preventDefault(); // Stop form submit reload
            
            // Populate Payment Summary
            document.getElementById('summary-model').innerText = currentModelName;
            document.getElementById('summary-color').innerText = currentOptions.color;
            document.getElementById('summary-base-price').innerText = '$' + basePrice.toLocaleString();
            document.getElementById('summary-rims').innerText = currentOptions.rims > 0 ? 'Carbon Finish' : 'Standard';
            document.getElementById('summary-calipers').innerText = currentOptions.calipers > 0 ? 'Painted' : 'Standard';
            
            const total = basePrice + currentOptions.rims + currentOptions.calipers;
            document.getElementById('summary-total').innerText = '$' + total.toLocaleString();

            // Switch Modals
            document.getElementById('user-info-modal').classList.add('hidden');
            document.getElementById('payment-modal').classList.remove('hidden');
        }

        function submitPayment(e) {
            e.preventDefault();
            
            const btn = document.getElementById('pay-btn');
            const originalText = btn.innerHTML;
            
            // Loading State
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i>';
            btn.disabled = true;

            setTimeout(() => {
                // Success
                document.getElementById('payment-modal').classList.add('hidden');
                document.getElementById('success-modal').classList.remove('hidden');
                document.getElementById('success-modal').classList.add('flex'); // Because default is hidden
                
                // Reset button for next time
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 2000);
        }

        function resetAll() {
            document.getElementById('success-modal').classList.add('hidden');
            document.getElementById('success-modal').classList.remove('flex');
            
            closeConfigurator();
            
            // Optional: Reset form fields
            document.getElementById('user-form').reset();
            document.getElementById('payment-form').reset();
        }

        // --- COLOR UTILITIES ---

        function rgbToHsl(r, g, b) {
            r /= 255, g /= 255, b /= 255;
            const max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max == min) {
                h = s = 0; // achromatic
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            return [h, s, l];
        }

        function hslToRgb(h, s, l) {
            let r, g, b;
            if (s == 0) {
                r = g = b = l; // achromatic
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }
    </script>
</body>
</html>